<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Students</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-5">
    <h1>Student List</h1>
    <a href="{{ url_for('add_student') }}" class="btn btn-success mb-3">Add Student</a>
    
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Membership Duration</th>  <!-- New Column for Membership Duration -->
                <th>Membership Expiry</th>     <!-- New Column for Membership Expiry -->
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
            <tr>
                <td>{{ student.name }}</td>
                <td>{{ student.email }}</td>
                <td>{{ student.phone }}</td>
                <td>{{ student.membership_duration }}</td> <!-- Display Membership Duration -->
                
                <!-- Display Membership Expiry (formatted) -->
                <td>{{ student.membership_expiry.strftime('%Y-%m-%d') if student.membership_expiry else 'N/A' }}</td>
                
                <td>
                    <a href="{{ url_for('edit_student', student_id=student._id) }}" class="btn btn-primary">Edit</a>
                    
                    <!-- Delete Button that triggers modal -->
                    <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal" 
                            data-student-id="{{ student._id }}" data-student-name="{{ student.name }}">
                        Delete
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteConfirmLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="deleteMessage">Are you sure you want to delete this student permanently?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="deleteForm" method="POST">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap & Script -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // When delete button is clicked, update the modal form action
    document.addEventListener("DOMContentLoaded", function() {
        var deleteModal = document.getElementById("deleteConfirmModal");
        
        deleteModal.addEventListener("show.bs.modal", function(event) {
            var button = event.relatedTarget;  // Button that triggered the modal
            var studentId = button.getAttribute("data-student-id");
            var studentName = button.getAttribute("data-student-name");
            
            var deleteMessage = document.getElementById("deleteMessage");
            deleteMessage.textContent = "Are you sure you want to delete " + studentName + " permanently?";
            
            var deleteForm = document.getElementById("deleteForm");
            deleteForm.action = "/students/delete/" + studentId;
        });
    });
</script>

</body>
</html>
